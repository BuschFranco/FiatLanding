---
import "../styles/global.css";
const { title = "Portuauto | Planes FIAT" } = Astro.props;
---
<html lang="es">
  <head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=AW-16671908962"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'AW-16671908962');
      window.gtag_report_conversion = function(url){
        var callback = function(){ if(typeof(url)!='undefined'){ window.location = url; } };
        gtag('event','conversion',{ send_to:'AW-16671908962/D-F_COrc_9EbE0LI5I0-', event_callback:callback });
        return false;
      }
    </script>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{title}</title>
    <link rel="icon" type="image/webp" href="/images/icon.webp" />
    <meta name="description" content="Descubre los mejores planes FIAT financiados por Portuauto. Ofrecemos financiamiento asequible y transparente para tu auto. ¡Contacta hoy mismo!" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet" />
  </head>
  <body>
    <div id="page-loader" class="page-loader"></div>
    <header class="site-header">
      <div class="container header-inner">
        <a href="/" class="brand">
          <img style="width: 12rem;" src="/images/logo.webp" alt="Portuauto" />
        </a>
        <nav class="nav">
          <a href="#planes" class="nav-link">Planes <span style="font-weight:600; color:var(--primary)">FIAT</span></a>
          <a href="#contacto" class="btn btn-outline">Contacto</a>
        </nav>
      </div>
    </header>
    <main>
      <slot />
    </main>
    <footer class="site-footer">
      <div class="container footer-inner">
       <a href="/" class="brand">
          <img style="width: 12rem;" src="/images/logo.webp" alt="Portuauto" />
        </a>
        <div class="footer-copy">© {new Date().getFullYear()} Portuauto. Todos los derechos reservados. · <a href="/legal#terminos">Términos y Condiciones</a> · <a href="/legal#privacidad">Políticas de Privacidad</a></div>
      </div>
    </footer>
    <div id="promo-popup" style="position:fixed;bottom:16px;right:16px;z-index:1000;display:none;background:#fff;border:1px solid var(--border);border-radius:12px;box-shadow:0 8px 24px rgba(0,0,0,0.18);overflow:hidden">
      <button class="promo-close" aria-label="Cerrar promoción" title="Cerrar" style="position:absolute;top:6px;right:6px;background:rgba(0,0,0,0.65);color:#fff;border:none;border-radius:999px;width:28px;height:28px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:16px;line-height:1">×</button>
      <a href="#contacto" aria-label="Ir al formulario de contacto" style="display:block">
        <img src="/images/ad/cronosAd.webp" alt="Promoción FIAT por plan" style="display:block;width:280px;max-width:90vw;height:auto" />
      </a>
    </div>
    <script>
      const l = document.getElementById('page-loader');
      const MIN_MS = 150;
      const TRANS_MS = 700;
      function hide(){ if(l){ l.classList.add('hidden'); setTimeout(()=>{ try{ l.remove(); }catch(_){ } }, TRANS_MS + 50); } }
      if(document.readyState === 'complete') {
        setTimeout(hide, MIN_MS);
      } else {
        const start = performance.now();
        window.addEventListener('load', ()=>{
          const elapsed = performance.now() - start;
          const wait = Math.max(0, MIN_MS - elapsed);
          setTimeout(hide, wait);
        });
      }
    </script>
    <script>
      document.addEventListener('DOMContentLoaded', ()=>{
        const planesLink = document.querySelector('.nav-link[href="#planes"]');
        if(planesLink){
          planesLink.addEventListener('click', (e)=>{
            const planesSection = document.getElementById('planes');
            if(!planesSection){
              e.preventDefault();
              const contactSection = document.getElementById('contacto');
              const form = document.querySelector('.contact-form');
              const consultaArea = form?.querySelector('textarea[name="consulta"]');
              if(contactSection && form){
                if(consultaArea) {
                  consultaArea.value = "Hola, quisiera consultar sobre los planes disponibles.";
                }
                contactSection.scrollIntoView({behavior:'smooth', block:'start'});
                const wrap = form.closest('.container');
                wrap?.classList.add('contact-pulse');
                setTimeout(()=>{ wrap?.classList.remove('contact-pulse'); }, 1600);
              } else {
                window.location.href = '/#planes';
              }
            }
          });
        }
        document.querySelectorAll('a[href="#contacto"]:not([data-model])')?.forEach(link=>{
          link.addEventListener('click', (e)=>{
            e.preventDefault();
            const modal = document.getElementById('contact-modal');
            const form = modal?.querySelector('.contact-form');
            const openModal = ()=>{
              if(!modal) return;
              modal.style.display = 'flex';
              document.body.style.overflow = 'hidden';
              const nombreInput = form?.querySelector('input[name="nombre"]');
              nombreInput?.focus();
            };
            openModal();
          });
        });
        const promo = document.getElementById('promo-popup');
        if(promo){
          promo.style.opacity = '0';
          promo.style.transform = 'translateY(12px)';
          promo.style.transition = 'opacity 300ms ease, transform 300ms ease';
          const show = ()=>{ promo.style.display = 'block'; requestAnimationFrame(()=>{ promo.style.opacity = '1'; promo.style.transform = 'translateY(0)'; }); };
          const hide = ()=>{ promo.style.opacity = '0'; promo.style.transform = 'translateY(12px)'; setTimeout(()=>{ promo.style.display = 'none'; }, 320); };
          const closeBtn = promo.querySelector('.promo-close');
          let hideTimer; let deadline = 0; let paused = false; let remaining = 0;
          const scheduleHide = (ms)=>{ clearTimeout(hideTimer); deadline = Date.now()+ms; hideTimer = setTimeout(()=>{ hide(); }, ms); };
          const pause = ()=>{ if(paused) return; paused = true; remaining = Math.max(0, deadline - Date.now()); clearTimeout(hideTimer); };
          const resume = ()=>{ if(!paused) return; paused = false; if(remaining>0){ hideTimer = setTimeout(()=>{ hide(); }, remaining); } else { hide(); } };
          setTimeout(()=>{ show(); scheduleHide(8000); }, 3000);
          closeBtn?.addEventListener('click', (ev)=>{ ev.preventDefault(); ev.stopPropagation(); clearTimeout(hideTimer); hide(); });
          promo.addEventListener('mouseenter', pause);
          promo.addEventListener('mouseleave', resume);
          promo.addEventListener('touchstart', pause, {passive:true});
          promo.addEventListener('touchend', resume, {passive:true});
          promo.addEventListener('touchcancel', resume, {passive:true});
        }
      });
    </script>
  </body>
</html>
<style>
  .nav-link {
    text-decoration: none;
    position: relative;
    color: inherit;
    display: inline-block;
  }
  
  .nav-link::after {
    content: '';
    position: absolute;
    width: 0;
    height: 2px;
    bottom: -2px;
    left: 0;
    background-color: var(--primary);
    transition: width 0.3s ease;
  }
  
  .nav-link:hover::after {
    width: 100%;
  }
</style>
